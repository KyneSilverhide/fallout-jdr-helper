name: NodeJS

on:
  push:
    branches: [ "bestiary" ]
  pull_request:
    branches: [ "bestiary" ]

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [16.x]
    
    steps:
    - uses: actions/checkout@v3

    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        
    - name: Install ionic
      run: npm install -g @ionic/cli

    - name: Build     
      run: |
        npm install
        ionic build --prod
        npx cap sync
        
    #- name: Archive production artifacts
    #  uses: actions/upload-artifact@v3
    #  with:
    #    name: www
    #    path: www
     
    #- name: SFTP Deploy
    #  uses: wlixcc/SFTP-Deploy-Action@v1.2.2
     # with:
    #    username: kyne
    #    server: kyne.ovh
     #   ssh_private_key: ${{ secrets.SSH_PRIVATE_KEY }}
   #     local_path: ./www/*
    #   remote_path: /home/kyne/fallout-test-www

    - name: SFTP Sync
      uses: swillner/sftp-sync-action@v1.0
      with:
        server: kyne.ovh
        user: kyne
        user_private_key: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAuY6UsORFI2g3WyigYr8HT37IlAKYH/lFgwp+JKE7Uq ed25519-key-20210313
        host_public_key: "ssh-rsa ACTUALKEYCONTENTHERE"
        local: ./www/
        remote: /home/kyne/fallout-test-www
        mirror_options: "--exclude-glob=.git*/ --verbose"
        
